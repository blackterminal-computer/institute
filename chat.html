<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Student Chat</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
margin:0;
padding:0;
overflow:hidden;
}

/* TOP BAR */
.top{
background:#0f172a;
padding:16px;
text-align:center;
font-size:18px;
font-weight:bold;
position:fixed;
top:0;
width:100%;
z-index:10;
}

/* CHAT AREA */
#chatBox{
position:fixed;
top:60px;
bottom:70px;
left:0;
right:0;
overflow-y:auto;
padding:12px;
}

/* MESSAGE */
.msg{
background:#111827;
padding:12px;
margin:8px 4px;
border-radius:14px;
text-align:left;
max-width:85%;
}

.name{
color:#22c55e;
font-weight:bold;
font-size:14px;
}

/* SEND BOX */
.sendBox{
position:fixed;
bottom:0;
left:0;
width:100%;
background:#0f172a;
padding:10px;
display:flex;
gap:8px;
box-shadow:0 -4px 20px rgba(0,0,0,0.6);
}

.sendBox input{
flex:1;
padding:14px;
border:none;
border-radius:12px;
font-size:16px;
outline:none;
}

.sendBox button{
padding:14px 18px;
border:none;
border-radius:12px;
background:linear-gradient(45deg,#6366f1,#06b6d4);
color:white;
font-size:16px;
font-weight:bold;
}

/* iPhone safe bottom */
@supports (padding: max(0px)) {
.sendBox{
padding-bottom: max(10px, env(safe-area-inset-bottom));
}
}
</style>
</head>

<body>

<div class="top">ðŸ’¬ Student Lounge</div>

<div id="chatBox"></div>

<div class="sendBox">
<input id="msg" placeholder="Type message...">
<button onclick="send()">âž¤</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, getDocs, deleteDoc, doc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let student=localStorage.getItem("studentName")||"Student";
let today=new Date().toDateString();

/* ðŸ”¥ DELETE OLD MSG DAILY */
async function clearOld(){
let snap=await getDocs(collection(db,"global_chat"));
snap.forEach(async(d)=>{
let data=d.data();
if(data.date!=today){
await deleteDoc(doc(db,"global_chat",d.id));
}
});
}
clearOld();

/* SEND */
window.send=async function(){
let text=document.getElementById("msg").value.trim();
if(!text) return;

await addDoc(collection(db,"global_chat"),{
name:student,
msg:text,
time:Date.now(),
date:today
});

document.getElementById("msg").value="";
};

/* LIVE CHAT */
const q=query(collection(db,"global_chat"),orderBy("time"));

onSnapshot(q,(snap)=>{
let html="";

snap.forEach(d=>{
let data=d.data();
if(data.date!=today) return;

html+=`
<div class="msg">
<span class="name">${data.name}</span><br>
${data.msg}
</div>`;
});

document.getElementById("chatBox").innerHTML=html;

/* auto scroll smooth */
setTimeout(()=>{
document.getElementById("chatBox").scrollTop=999999;
},100);
});

</script>
</body>
</html>