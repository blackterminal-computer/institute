<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Profile</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:18px;
max-width:520px;
margin:auto;
box-shadow:0 0 40px rgba(0,0,0,0.6);
}

.avatar{
width:150px;
height:150px;
border-radius:50%;
object-fit:cover;
border:4px solid #22c55e;
box-shadow:0 0 25px #22c55e;
margin-top:10px;
}

input,textarea{
width:90%;
padding:12px;
border:none;
border-radius:10px;
margin:8px;
font-size:16px;
}

button{
padding:12px 20px;
border:none;
border-radius:12px;
margin:8px;
font-weight:bold;
background:linear-gradient(90deg,#6366f1,#06b6d4);
color:white;
}

.statBox{
background:#111827;
padding:12px;
border-radius:12px;
margin-top:10px;
}
</style>
</head>
<body>

<div class="card">

<h2>ğŸ‘¤ My Profile</h2>

<img id="photo" class="avatar" src="">

<br>
<input type="file" id="file">

<!-- NAME -->
<input id="nameInput" placeholder="Enter your name">
<br>
<button onclick="saveName()">Save Name</button>

<h3 id="showName">Loading...</h3>

<!-- BIO -->
<textarea id="bio" placeholder="Write your bio..."></textarea>
<button onclick="saveBio()">Save Bio</button>

<div class="statBox">â­ XP: <span id="xp">0</span></div>
<div class="statBox">ğŸ”¥ Streak: <span id="streak">0</span></div>
<div class="statBox">ğŸ† Rank: <span id="rank">--</span></div>

<br>
<button onclick="location.href='index.html'">ğŸ  Home</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, collection, getDocs }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let student=localStorage.getItem("studentName")||"Student";
const ref=doc(db,"students",student);

let snap=await getDoc(ref);

let xp=0,streak=0,name=student,bio="",photo="";

if(snap.exists()){
let d=snap.data();
xp=d.xp||0;
streak=d.streak||0;
name=d.name||student;
bio=d.bio||"";
photo=d.photo||"";
}

/* SHOW */
document.getElementById("xp").innerText=xp;
document.getElementById("streak").innerText=streak;
document.getElementById("showName").innerText=name;
document.getElementById("nameInput").value=name;
document.getElementById("bio").value=bio;

if(photo) document.getElementById("photo").src=photo;
else document.getElementById("photo").src="https://i.imgur.com/6VBx3io.png";

/* SAVE NAME */
window.saveName=async function(){
let n=document.getElementById("nameInput").value.trim();
if(!n) return alert("Enter name");

await setDoc(ref,{name:n},{merge:true});
document.getElementById("showName").innerText=n;
alert("Name saved");
}

/* SAVE BIO */
window.saveBio=async function(){
let b=document.getElementById("bio").value;
await setDoc(ref,{bio:b},{merge:true});
alert("Bio saved");
}

/* PHOTO */
document.getElementById("file").addEventListener("change",function(e){
let file=e.target.files[0];
let reader=new FileReader();
reader.onload=async function(){
let base=reader.result;
document.getElementById("photo").src=base;
await setDoc(ref,{photo:base},{merge:true});
}
reader.readAsDataURL(file);
});

/* RANK */
let snapAll=await getDocs(collection(db,"students"));
let arr=[];
snapAll.forEach(d=>{
arr.push({name:d.id,xp:d.data().xp||0});
});
arr.sort((a,b)=>b.xp-a.xp);

let rank=arr.findIndex(x=>x.name==student)+1;
document.getElementById("rank").innerText="#"+rank;

</script>
</body>
</html>