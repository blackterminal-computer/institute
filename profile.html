<!DOCTYPE html>
<html>
<head>
<title>My Profile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
font-family:Arial;
background:#020617;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
}

.box{
background:#0f172a;
padding:30px;
border-radius:18px;
width:320px;
text-align:center;
}

img{
width:110px;
height:110px;
border-radius:50%;
object-fit:cover;
border:3px solid #22c55e;
}

button{
margin-top:15px;
padding:12px;
width:100%;
background:linear-gradient(45deg,#6366f1,#06b6d4);
border:none;
border-radius:10px;
color:white;
}
</style>
</head>

<body>

<div class="box">
<h2>üë§ My Profile</h2>

<img id="photo" src="https://via.placeholder.com/110">
<input type="file" onchange="uploadPhoto(event)">

<input id="nameInput" placeholder="Enter your name"
style="padding:10px;width:100%;border-radius:8px;border:none;margin-top:12px">

<button onclick="saveName()">Save Name</button>

<h3 id="name"></h3>

<div id="paymentStatus" style="
margin-top:15px;
padding:12px;
border-radius:12px;
background:#111827;
font-weight:bold">
Checking payment...
</div>

<button onclick="window.location='index.html'">Home</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let student = localStorage.getItem("studentName") || "";
document.getElementById("name").innerHTML=student;
document.getElementById("nameInput").value=student;

// photo
let photo = localStorage.getItem("photo_"+student);
if(photo){document.getElementById("photo").src=photo;}

window.uploadPhoto=function(e){
let file = e.target.files[0];
let reader = new FileReader();
reader.onload=function(){
localStorage.setItem("photo_"+student,reader.result);
document.getElementById("photo").src=reader.result;
}
reader.readAsDataURL(file);
}

// ‚≠ê SAVE NAME + AUTO ADD TO PAYMENT
window.saveName=async function(){

let newName=document.getElementById("nameInput").value.trim();
if(!newName){alert("Enter name");return;}

localStorage.setItem("studentName",newName);
document.getElementById("name").innerHTML=newName;

// üî• auto create payment record if not exist
let ref=doc(db,"payments",newName);
let snap=await getDoc(ref);

if(!snap.exists()){
await setDoc(ref,{
name:newName,
status:"OVERDUE",
lastPaid:""
});
}

alert("Saved & Added to payment system");
location.reload();
}

// ‚≠ê CHECK PAYMENT STATUS
async function checkPayment(){

let name=localStorage.getItem("studentName");
if(!name) return;

let snap=await getDoc(doc(db,"payments",name));

if(!snap.exists()){
document.getElementById("paymentStatus").innerHTML=
"üí≥ Payment Status: NOT ADDED";
return;
}

let d=snap.data();
let color="#22c55e";

if(d.status=="OVERDUE") color="red";
if(d.status=="COMPLETED") color="#38bdf8";

document.getElementById("paymentStatus").innerHTML=
`üí≥ Payment Status: <span style="color:${color}">${d.status}</span>`;
}

checkPayment();

</script>
</body>
</html>