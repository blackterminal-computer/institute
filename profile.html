<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>My Profile</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
margin:0;
padding:0;
display:flex;
justify-content:center;
}

.container{
width:100%;
max-width:420px;
padding:18px;
padding-bottom:90px;
}

.card{
background:#0f172a;
padding:22px;
border-radius:22px;
margin-top:20px;
box-shadow:0 0 40px rgba(0,0,0,0.6);
text-align:center;
}

/* avatar */
.avatarBox{
display:flex;
justify-content:center;
margin-top:10px;
}

.avatar{
width:140px;
height:140px;
border-radius:50%;
border:4px solid #22c55e;
object-fit:cover;
box-shadow:0 0 25px #22c55e;
cursor:pointer;
transition:.3s;
}

.avatar:active{
transform:scale(0.95);
}

/* inputs */
input,textarea{
width:100%;
padding:14px;
margin-top:14px;
border-radius:12px;
border:none;
font-size:16px;
outline:none;
background:#020617;
color:white;
}

/* buttons */
button{
width:100%;
padding:14px;
border:none;
border-radius:12px;
margin-top:14px;
font-size:16px;
font-weight:bold;
background:linear-gradient(90deg,#6366f1,#06b6d4);
color:white;
box-shadow:0 0 20px rgba(0,255,255,0.3);
}

/* stats */
.stats{
background:#020617;
padding:16px;
border-radius:14px;
margin-top:18px;
font-size:17px;
text-align:left;
line-height:1.8;
}

/* name */
.name{
font-size:22px;
font-weight:bold;
margin-top:10px;
}

.bio{
opacity:.8;
margin-top:8px;
}

/* home btn fix */
.homeBtn{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
width:90%;
max-width:380px;
}

</style>
</head>

<body>

<div class="container">

<div class="card">

<h2>üë§ My Profile</h2>

<!-- PHOTO -->
<div class="avatarBox">
<img id="photo" class="avatar"
src="https://cdn-icons-png.flaticon.com/512/149/149071.png"
onclick="document.getElementById('file').click()">
<input type="file" id="file" accept="image/*" hidden>
</div>

<!-- NAME -->
<input id="nameInput" placeholder="Enter name">
<button onclick="saveName()">Save Name</button>

<div class="name" id="showName">Student</div>

<!-- BIO -->
<textarea id="bioInput" placeholder="Write bio..."></textarea>
<button onclick="saveBio()">Save Bio</button>

<div class="bio" id="showBio">No bio yet</div>

<!-- STATS -->
<div class="stats">
‚≠ê XP: <span id="xp">0</span><br>
üî• Streak: <span id="streak">0</span><br>
üèÜ Rank: <span id="rank">#0</span>
</div>

</div>

</div>

<button class="homeBtn" onclick="location.href='index.html'">üè† Home</button>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, collection, getDocs }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let student=localStorage.getItem("studentName")||"Student";

/* LOAD */
async function loadProfile(){

let ref=doc(db,"students",student);
let snap=await getDoc(ref);

if(snap.exists()){
let d=snap.data();

document.getElementById("showName").innerText=student;
document.getElementById("nameInput").value=student;

document.getElementById("showBio").innerText=d.bio||"No bio yet";
document.getElementById("bioInput").value=d.bio||"";

document.getElementById("xp").innerText=d.xp||0;
document.getElementById("streak").innerText=d.streak||0;

if(d.photo) document.getElementById("photo").src=d.photo;
}

/* rank */
let snap2=await getDocs(collection(db,"students"));
let arr=[];
snap2.forEach(s=>{
arr.push({name:s.id,xp:s.data().xp||0});
});

arr.sort((a,b)=>b.xp-a.xp);
let r=arr.findIndex(x=>x.name==student)+1;
if(r>0) document.getElementById("rank").innerText="#"+r;
}

loadProfile();

/* SAVE NAME */
window.saveName=async function(){
let newName=document.getElementById("nameInput").value.trim();
if(!newName) return;

localStorage.setItem("studentName",newName);

await setDoc(doc(db,"students",newName),{
xp:0,
streak:0
},{merge:true});

alert("Reload page");
}

/* SAVE BIO */
window.saveBio=async function(){
let bio=document.getElementById("bioInput").value;

await setDoc(doc(db,"students",student),{
bio:bio
},{merge:true});

document.getElementById("showBio").innerText=bio;
alert("Bio saved");
}

/* PHOTO */
document.getElementById("file").addEventListener("change",async function(e){

let file=e.target.files[0];
if(!file) return;

let reader=new FileReader();

reader.onload=async function(event){
let base64=event.target.result;
document.getElementById("photo").src=base64;

await setDoc(doc(db,"students",student),{
photo:base64
},{merge:true});

alert("Photo updated üî•");
};

reader.readAsDataURL(file);
});

</script>
</body>
</html>