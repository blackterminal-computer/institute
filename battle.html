<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1 vs 1 Battle</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{
background:#020617;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
flex-direction:column;
}

/* waiting */
#wait{
text-align:center;
}

.loader{
margin-top:20px;
width:60px;height:60px;
border:5px solid #111;
border-top:5px solid #06b6d4;
border-radius:50%;
animation:spin 1s linear infinite;
margin:auto;
}

@keyframes spin{
100%{transform:rotate(360deg)}
}

/* vs screen */
#vsScreen{
display:none;
text-align:center;
animation:fade 0.6s;
}

.vs{
font-size:40px;
margin:20px 0;
color:#22c55e;
}

/* quiz */
#quiz{
display:none;
width:95%;
max-width:500px;
background:#0f172a;
padding:25px;
border-radius:16px;
}

.option{
background:#1e293b;
padding:14px;
margin:10px 0;
border-radius:10px;
cursor:pointer;
transition:.3s;
}

.option:hover{
background:#334155;
}

.lock{
background:#065f46 !important;
border:2px solid #22c55e;
}

.timer{
float:right;
color:#22c55e;
font-weight:bold;
}

#result{
display:none;
text-align:center;
}

button{
margin-top:20px;
padding:14px 24px;
border:none;
border-radius:10px;
background:linear-gradient(45deg,#6366f1,#06b6d4);
color:white;
font-weight:bold;
}

</style>
</head>
<body>

<!-- waiting -->
<div id="wait">
<h2>üîé Waiting for opponent...</h2>
<div class="loader"></div>
</div>

<!-- vs -->
<div id="vsScreen">
<h1 id="p1"></h1>
<div class="vs">VS</div>
<h1 id="p2"></h1>
</div>

<!-- quiz -->
<div id="quiz">
<div>Question <span id="qno"></span>/15 
<span class="timer">‚è± <span id="time">60</span>s</span></div>
<h3 id="question" style="margin-top:15px"></h3>
<div id="options"></div>
<button onclick="next()">Next</button>
</div>

<!-- result -->
<div id="result">
<h1>üèÜ Battle Finished</h1>
<h2 id="winner"></h2>
<button onclick="location.reload()">Play Again</button>
</div>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getFirestore, collection, addDoc, getDocs,
doc, setDoc, onSnapshot, deleteDoc, updateDoc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.firebasestorage.app",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db=getFirestore(app);

let student=localStorage.getItem("studentName")||prompt("Enter name");
localStorage.setItem("studentName",student);

// join waiting
let myRef=await addDoc(collection(db,"battle_wait"),{
name:student,
time:Date.now()
});

// check match
let started=false;

setInterval(async()=>{
if(started) return;

let snap=await getDocs(collection(db,"battle_wait"));
let arr=[];
snap.forEach(d=>arr.push({id:d.id,...d.data()}));

if(arr.length>=2){

started=true;

let p1=arr[0];
let p2=arr[1];
let battleId="battle_"+Date.now();

await setDoc(doc(db,"battles",battleId),{
p1:p1.name,
p2:p2.name,
q:0,
score1:0,
score2:0,
time:60
});

await deleteDoc(doc(db,"battle_wait",p1.id));
await deleteDoc(doc(db,"battle_wait",p2.id));

startBattle(battleId,p1.name,p2.name);
}
},2000);

async function startBattle(id,n1,n2){

document.getElementById("wait").style.display="none";
document.getElementById("vsScreen").style.display="block";

document.getElementById("p1").innerText=n1;
document.getElementById("p2").innerText=n2;

setTimeout(()=>{
document.getElementById("vsScreen").style.display="none";
document.getElementById("quiz").style.display="block";
},2500);

listenBattle(id,n1,n2);
}

