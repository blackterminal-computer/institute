<!DOCTYPE html>
<html>
<head>
<title>1 vs 1 Battle</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
margin:0;
font-family:Arial;
background:#020617;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
text-align:center;
}

.box{
width:95%;
max-width:600px;
background:#0f172a;
padding:25px;
border-radius:18px;
}

.opt{
background:#1f2937;
padding:14px;
margin-top:12px;
border-radius:10px;
cursor:pointer;
}

.timer{
font-size:22px;
color:#22c55e;
margin-bottom:10px;
}

.vs{
font-size:50px;
font-weight:bold;
background:linear-gradient(45deg,#6366f1,#06b6d4);
-webkit-background-clip:text;
-webkit-text-fill-color:transparent;
}
</style>
</head>

<body>

<div class="box" id="screen">
<h2>‚öî Waiting for opponent...</h2>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, setDoc, getDoc, deleteDoc } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.firebasestorage.app",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName");
if(!student){
student = prompt("Enter name");
localStorage.setItem("studentName",student);
}

// üî• 15 QUESTIONS
let quiz=[
{q:"Brain of computer?",o:["RAM","CPU","Mouse","Keyboard"],a:1},
{q:"Excel is?",o:["Software","Game","OS","Browser"],a:0},
{q:"1 KB = ?",o:["1000","1024","500","200"],a:1},
{q:"WWW full form?",o:["World Wide Web","Web","Wide","None"],a:0},
{q:"Mouse is?",o:["Input","Output","CPU","RAM"],a:0},
{q:"Keyboard type?",o:["Input","Output","Both","None"],a:0},
{q:"Monitor is?",o:["Output","Input","CPU","RAM"],a:0},
{q:"RAM stands for?",o:["Random Access Memory","Read Access","Run Memory","None"],a:0},
{q:"Computer shortcut copy?",o:["Ctrl+C","Ctrl+V","Ctrl+X","Ctrl+Z"],a:0},
{q:"Paste shortcut?",o:["Ctrl+V","Ctrl+C","Ctrl+X","Ctrl+A"],a:0},
{q:"Internet full form?",o:["Interconnected Network","Internal","Net","None"],a:0},
{q:"File delete?",o:["Del","Esc","Tab","Ctrl"],a:0},
{q:"Windows is?",o:["OS","Game","App","Browser"],a:0},
{q:"Printer is?",o:["Output","Input","CPU","RAM"],a:0},
{q:"Hard disk?",o:["Storage","Input","Output","None"],a:0}
];

// join waiting
let my = await addDoc(collection(db,"battle_wait"),{
name:student,time:Date.now()
});

// match making
let matchInterval=setInterval(async()=>{
let snap=await getDocs(collection(db,"battle_wait"));
let arr=[];
snap.forEach(d=>arr.push({id:d.id,...d.data()}));

if(arr.length>=2){
let p1=arr[0];
let p2=arr[1];
let battleId="battle_"+Date.now();

await setDoc(doc(db,"battles",battleId),{
p1:p1.name,
p2:p2.name,
start:Date.now()
});

await deleteDoc(doc(db,"battle_wait",p1.id));
await deleteDoc(doc(db,"battle_wait",p2.id));

clearInterval(matchInterval);
startBattle(battleId,p1.name,p2.name);
}
},2000);

async function startBattle(id,n1,n2){

let opponent = student==n1?n2:n1;

// VS screen
document.getElementById("screen").innerHTML=
`<h2>${student}</h2>
<div class="vs">VS</div>
<h2>${opponent}</h2>`;

setTimeout(()=>startQuiz(id,n1,n2),2000);
}

function startQuiz(id,n1,n2){

let i=0,score=0;
let time=60;

function load(){
let q=quiz[i];
let html=`<div class="timer">‚è± ${time}s</div>
<h3>${student} vs ${student==n1?n2:n1}</h3>
<h2>${q.q}</h2>`;

q.o.forEach((opt,idx)=>{
html+=`<div class="opt" onclick="ans(${idx})">${opt}</div>`;
});

document.getElementById("screen").innerHTML=html;
}
load();

window.ans=async function(idx){
if(idx==quiz[i].a) score++;
i++;
if(i<quiz.length) load();
else finish();
}

// timer
let t=setInterval(()=>{
time--;
if(time<=0){
clearInterval(t);
finish();
}
},1000);

async function finish(){

await setDoc(doc(db,"battle_score",id+"_"+student),{
name:student,score:score
});

document.getElementById("screen").innerHTML="<h2>Waiting opponent...</h2>";

setTimeout(async()=>{
let s1=await getDoc(doc(db,"battle_score",id+"_"+n1));
let s2=await getDoc(doc(db,"battle_score",id+"_"+n2));

if(!s1.exists()||!s2.exists()) return;

let sc1=s1.data().score;
let sc2=s2.data().score;

let my = student==n1?sc1:sc2;
let opp = student==n1?sc2:sc1;

let res="Draw ü§ù";
if(my>opp) res="üèÜ You Win!";
if(my<opp) res="üò¢ You Lose";

document.getElementById("screen").innerHTML=
`<h1>${res}</h1>
<h2>${my} vs ${opp}</h2>
<button onclick="location.reload()">Play Again</button>`;
},3000);
}
}

</script>
</body>
</html>