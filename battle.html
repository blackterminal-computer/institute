<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Battle</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding-top:120px;
}

.card{
background:#0f172a;
padding:30px;
border-radius:16px;
width:90%;
max-width:400px;
margin:auto;
box-shadow:0 0 30px rgba(0,0,0,0.5);
}

h1{color:#22c55e}
</style>
</head>
<body>

<div class="card">
<h2>üîç Finding opponent...</h2>
<p id="status">Connecting...</p>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, onSnapshot }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.appspot.com",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName");
if(!student){
student = prompt("Enter your name");
localStorage.setItem("studentName",student);
}

async function startMatch(){

let rooms = await getDocs(collection(db,"matchmaking"));
let joined=false;

// join existing
rooms.forEach(async(r)=>{
let d=r.data();

if(!d.p2 && d.p1!=student && !joined){
joined=true;

await updateDoc(doc(db,"matchmaking",r.id),{
p2:student,
status:"start"
});

listenBattle(r.id);
}
});

// create new
if(!joined){
let ref = await addDoc(collection(db,"matchmaking"),{
p1:student,
p2:"",
status:"waiting"
});

listenBattle(ref.id);
}

}

startMatch();

function listenBattle(id){

onSnapshot(doc(db,"matchmaking",id),(snap)=>{
let d=snap.data();
if(!d) return;

if(d.status=="start"){
document.body.innerHTML=`
<div class="card">
<h1>‚öî Battle Connected</h1>
<h2>${d.p1} VS ${d.p2}</h2>
<h3>Connection success ‚úÖ</h3>
</div>
`;
}
});

}

</script>
</body>
</html>