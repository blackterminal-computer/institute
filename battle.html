<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>1 vs 1 Battle</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600;800&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}
body{
background:#020617;
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
overflow:hidden;
}

/* center box */
.box{
width:92%;
max-width:420px;
background:rgba(255,255,255,0.05);
backdrop-filter:blur(20px);
border-radius:22px;
padding:30px 20px;
text-align:center;
box-shadow:0 0 40px rgba(0,0,0,0.6);
}

/* searching */
#searching{
font-size:22px;
font-weight:700;
margin-top:20px;
}

.loader{
margin:30px auto;
width:70px;
height:70px;
border-radius:50%;
border:6px solid #111;
border-top:6px solid #06b6d4;
animation:spin 1s linear infinite;
}
@keyframes spin{
100%{transform:rotate(360deg)}
}

/* vs screen */
#vsScreen{
display:none;
}

.vs{
font-size:40px;
font-weight:800;
margin:20px 0;
color:#06b6d4;
animation:pulse 1s infinite;
}
@keyframes pulse{
0%{transform:scale(1)}
50%{transform:scale(1.2)}
100%{transform:scale(1)}
}

.player{
display:flex;
align-items:center;
justify-content:space-between;
margin:12px 0;
background:rgba(255,255,255,0.06);
padding:12px 15px;
border-radius:12px;
}

.player img{
width:45px;
height:45px;
border-radius:50%;
object-fit:cover;
border:2px solid #06b6d4;
}

/* quiz */
#quizBox{display:none}

.q{
font-size:20px;
font-weight:700;
margin-bottom:20px;
}

.opt{
background:#1f2937;
padding:12px;
border-radius:10px;
margin:10px 0;
cursor:pointer;
transition:.3s;
}

.opt:hover{background:#374151}

.lock{
background:#065f46 !important;
border:2px solid #22c55e;
}

/* timer */
#timer{
position:absolute;
top:20px;
right:20px;
color:#22c55e;
font-weight:700;
}

/* score */
.scorebar{
display:flex;
justify-content:space-between;
margin-bottom:10px;
font-weight:700;
}

/* result */
#resultBox{display:none}
.win{
font-size:26px;
font-weight:800;
margin:20px 0;
}
button{
padding:14px 20px;
border:none;
border-radius:12px;
background:linear-gradient(45deg,#6366f1,#06b6d4);
color:white;
font-weight:700;
}
</style>
</head>

<body>

<div class="box">

<div id="timer">60s</div>

<!-- searching -->
<div id="searchBox">
<h2>üîé Finding opponent...</h2>
<div class="loader"></div>
<div id="searching">Please wait</div>
</div>

<!-- VS -->
<div id="vsScreen">
<div class="player">
<span id="p1name"></span>
<img id="p1img" src="">
</div>

<div class="vs">VS</div>

<div class="player">
<span id="p2name"></span>
<img id="p2img" src="">
</div>
</div>

<!-- QUIZ -->
<div id="quizBox">
<div class="scorebar">
<span id="meScore">You:0</span>
<span id="opScore">Opp:0</span>
</div>

<div class="q" id="q">Question</div>

<div class="opt" onclick="answer(this)">A</div>
<div class="opt" onclick="answer(this)">B</div>
<div class="opt" onclick="answer(this)">C</div>
<div class="opt" onclick="answer(this)">D</div>
</div>

<!-- RESULT -->
<div id="resultBox">
<h2>üèÜ Battle Finished</h2>
<div class="win" id="winnerText"></div>
<button onclick="location.reload()">Play Again</button>
</div>

</div>
</body>
</html>












<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
getFirestore,collection,addDoc,doc,
onSnapshot,updateDoc,deleteDoc,getDocs
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* üî• YOUR FIREBASE */
const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.appspot.com",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* student */
let student = localStorage.getItem("studentName") || prompt("Enter name");

/* questions */
let quiz = [
{q:"Brain of computer?",o:["RAM","CPU","Mouse","Keyboard"],a:"CPU"},
{q:"Full form of WWW?",o:["World Wide Web","Web World Wide","Wide Web World","None"],a:"World Wide Web"},
{q:"1 byte = ?",o:["4 bits","8 bits","16 bits","32 bits"],a:"8 bits"},
{q:"Excel is?",o:["OS","Software","Hardware","Game"],a:"Software"},
{q:"Computer shortcut copy?",o:["Ctrl+C","Ctrl+V","Ctrl+X","Ctrl+Z"],a:"Ctrl+C"}
];

let battleId=null;
let myScore=0;
let oppScore=0;
let qIndex=0;
let started=false;
let timer=60;

/* FIND OR CREATE BATTLE */
async function findBattle(){

const snap = await getDocs(collection(db,"battles"));
let found=null;

snap.forEach(d=>{
let data=d.data();
if(!data.p2 && data.p1!=student){
found={id:d.id,...data};
}
});

if(found){
battleId=found.id;
await updateDoc(doc(db,"battles",battleId),{p2:student});
showVS(found.p1,student);
listenBattle();
}
else{
let ref=await addDoc(collection(db,"battles"),{
p1:student,p2:null,score1:0,score2:0,q:0
});
battleId=ref.id;
listenBattle();
}
}

findBattle();

/* LISTEN */
function listenBattle(){
onSnapshot(doc(db,"battles",battleId),(docu)=>{
let d=docu.data();
if(!d) return;

if(d.p1 && d.p2 && !started){
started=true;
showVS(d.p1,d.p2);
setTimeout(startGame,2000);
}

if(started){
document.getElementById("meScore").innerHTML="You:"+(
d.p1==student?d.score1:d.score2);
document.getElementById("opScore").innerHTML="Opp:"+(
d.p1==student?d.score2:d.score1);
}
});
}

/* VS SCREEN */
function showVS(p1,p2){
document.getElementById("searchBox").style.display="none";
document.getElementById("vsScreen").style.display="block";

document.getElementById("p1name").innerHTML=p1;
document.getElementById("p2name").innerHTML=p2;

document.getElementById("p1img").src="https://ui-avatars.com/api/?name="+p1;
document.getElementById("p2img").src="https://ui-avatars.com/api/?name="+p2;
}

/* START GAME */
function startGame(){
document.getElementById("vsScreen").style.display="none";
document.getElementById("quizBox").style.display="block";
loadQ();
startTimer();
}

/* LOAD QUESTION */
function loadQ(){
let q=quiz[qIndex];
document.getElementById("q").innerHTML="Q"+(qIndex+1)+". "+q.q;

let opts=document.querySelectorAll(".opt");
opts.forEach((o,i)=>{
o.innerHTML=q.o[i];
o.classList.remove("lock");
});
}

/* ANSWER */
window.answer=async(el)=>{
if(el.classList.contains("lock"))return;
el.classList.add("lock");

let correct=quiz[qIndex].a;

if(el.innerHTML==correct){
myScore++;
}

let ref=doc(db,"battles",battleId);

if(student==document.getElementById("p1name").innerHTML){
await updateDoc(ref,{score1:myScore});
}else{
await updateDoc(ref,{score2:myScore});
}

setTimeout(nextQ,500);
}

/* NEXT */
function nextQ(){
qIndex++;
if(qIndex>=quiz.length){
finish();
return;
}
loadQ();
}

/* TIMER */
function startTimer(){
let t=setInterval(()=>{
timer--;
document.getElementById("timer").innerHTML=timer+"s";
if(timer<=0){
clearInterval(t);
finish();
}
},1000);
}

/* FINISH */
async function finish(){
document.getElementById("quizBox").style.display="none";
document.getElementById("resultBox").style.display="block";

let winText="Draw ü§ù";

const ref=doc(db,"battles",battleId);
const snap=await getDocs(collection(db,"battles"));

let finalMe=myScore;
let finalOpp=0;

snap.forEach(d=>{
if(d.id==battleId){
let data=d.data();
finalOpp = (student==data.p1)?data.score2:data.score1;
}
});

if(finalMe>finalOpp) winText="You Win üèÜ +20XP";
if(finalMe<finalOpp) winText="You Lose üò¢ -10XP";

document.getElementById("winnerText").innerHTML=
student+" : "+finalMe+" | Opp : "+finalOpp+"<br>"+winText;

await deleteDoc(doc(db,"battles",battleId));
}

</script>














