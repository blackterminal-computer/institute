<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily MCQ Test</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:16px;
max-width:500px;
margin:auto;
box-shadow:0 0 40px rgba(0,0,0,0.6);
}

button{
width:90%;
padding:15px;
margin:8px;
border:none;
border-radius:12px;
font-size:16px;
font-weight:bold;
background:#1e293b;
color:white;
}

.next{
background:linear-gradient(90deg,#6366f1,#06b6d4);
}

h2{color:#22c55e}
.timer{color:#22c55e;font-size:20px}
</style>
</head>
<body>

<div class="card">

<h2>üß† Daily Test</h2>
<div>‚è± Time: <span class="timer" id="time">20</span>s</div>
<h3 id="qtext">Loading...</h3>

<div id="options"></div>

<button class="next" onclick="nextQ()">Next</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName");
if(!student){
student = prompt("Enter name");
localStorage.setItem("studentName",student);
}

let qIndex=1;
let score=0;
let timer;
let timeLeft=20;
let answered=false;

loadQ();

async function loadQ(){

answered=false;
timeLeft=20;
document.getElementById("time").innerHTML=timeLeft;

timer=setInterval(()=>{
timeLeft--;
document.getElementById("time").innerHTML=timeLeft;

if(timeLeft<=0){
clearInterval(timer);
nextQ();
}
},1000);

let snap = await getDoc(doc(db,"daily_mcq","q"+qIndex));

if(!snap.exists()){
finishTest();
return;
}

let d=snap.data();

document.getElementById("qtext").innerHTML=
"Q"+qIndex+". "+d.question;

document.getElementById("options").innerHTML=`
<button onclick="ans('A')">${d.a}</button>
<button onclick="ans('B')">${d.b}</button>
<button onclick="ans('C')">${d.c}</button>
<button onclick="ans('D')">${d.d}</button>
`;

window.correctAns=d.correct;

}

window.ans=function(a){
if(answered) return;
answered=true;

if(a===correctAns){
score+=2;
}

}

window.nextQ=function(){
clearInterval(timer);
qIndex++;

if(qIndex>20){
finishTest();
}else{
loadQ();
}
}

async function finishTest(){

document.body.innerHTML=`
<div class="card">
<h1>üèÅ Test Finished</h1>
<h2>Score: ${score}</h2>
<h3>XP Earned: ${score}</h3>
</div>
`;

let ref=doc(db,"students",student);
let s=await getDoc(ref);

if(s.exists()){
let xp=s.data().xp||0;
xp+=score;

await updateDoc(ref,{xp:xp});
}

}

</script>
</body>
</html>