<!DOCTYPE html>
<html>
<head>
<title>Daily Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
margin:0;
font-family:Arial;
background:radial-gradient(circle,#020617,#000);
color:white;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
overflow:hidden;
}

.box{
width:95%;
max-width:650px;
background:#0f172a;
padding:25px;
border-radius:18px;
}

.timer{
float:right;
color:#22c55e;
font-weight:bold;
}

.opt{
background:#1f2937;
padding:14px;
margin-top:12px;
border-radius:10px;
cursor:pointer;
border:2px solid transparent;
transition:.2s;
}

.opt:hover{transform:scale(1.03)}

.locked{
border:2px solid #22c55e;
box-shadow:0 0 20px #22c55e;
background:#020617;
}

button{
margin-top:20px;
padding:14px;
width:100%;
background:linear-gradient(45deg,#6366f1,#06b6d4);
border:none;
border-radius:10px;
color:white;
font-size:16px;
}

canvas{
position:fixed;
top:0;
left:0;
pointer-events:none;
}
</style>
</head>

<body>

<div class="box">
<div class="timer">‚è± <span id="time">300</span>s</div>
<h3 id="qno"></h3>
<h2 id="question"></h2>
<div id="options"></div>
<button onclick="next()">Next</button>
</div>

<audio id="click">
<source src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_c8c8a73467.mp3">
</audio>

<script type="module">

// üî• FIREBASE
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.firebasestorage.app",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// name
let student = localStorage.getItem("studentName");
if(!student){
student = prompt("Enter name");
localStorage.setItem("studentName",student);
}

// questions
let quiz=[
{q:"Brain of computer?",o:["RAM","CPU","Mouse","Keyboard"],a:1},
{q:"CPU full form?",o:["Central Process Unit","Central Processing Unit","Unit","Process"],a:1},
{q:"Excel is?",o:["Software","Game","OS","Browser"],a:0},
{q:"1 KB = ?",o:["1000","1024","500","200"],a:1},
{q:"WWW full form?",o:["World Wide Web","Web","Wide","None"],a:0}
];

let i=0,score=0,selected=-1,locked=false,time=300;

function load(){
document.getElementById("qno").innerHTML="Question "+(i+1)+"/"+quiz.length;
document.getElementById("question").innerHTML=quiz[i].q;

let html="";
quiz[i].o.forEach((x,idx)=>{
html+=`<div class="opt" onclick="select(this,${idx})">${x}</div>`;
});
document.getElementById("options").innerHTML=html;
}
load();

window.select=function(el,idx){
if(locked) return;

document.getElementById("click").play();
document.querySelectorAll(".opt").forEach(o=>o.classList.remove("locked"));

el.classList.add("locked");
locked=true;
selected=idx;
}

window.next=function(){
if(selected==-1){alert("Select option");return;}

if(selected==quiz[i].a) score++;

selected=-1;
locked=false;
i++;

if(i<quiz.length){
load();
}else finish();
}

// timer
let t=setInterval(()=>{
time--;
document.getElementById("time").innerHTML=time;
if(time<=0){clearInterval(t);finish();}
},1000);

// finish
async function finish(){
clearInterval(t);

let xp = score*10;

// streak
let streakData = JSON.parse(localStorage.getItem("streakData"))||{};
let today=new Date().toLocaleDateString();

if(!streakData[student]){
streakData[student]={streak:1,lastDate:today};
}else{
let last=streakData[student].lastDate;
let y=new Date();y.setDate(y.getDate()-1);
let yest=y.toLocaleDateString();

if(last==yest) streakData[student].streak+=1;
else if(last!=today) streakData[student].streak=1;

streakData[student].lastDate=today;
}
localStorage.setItem("streakData",JSON.stringify(streakData));
let streak=streakData[student].streak;

// xp
let xpData = JSON.parse(localStorage.getItem("xpData"))||{};
if(!xpData[student]) xpData[student]=0;
xpData[student]+=xp;
localStorage.setItem("xpData",JSON.stringify(xpData));

// firebase save
await setDoc(doc(db,"students",student),{
name:student,
xp:xpData[student],
streak:streak,
photo:localStorage.getItem("photo_"+student)||""
});

// result UI
document.querySelector(".box").innerHTML=`
<h1>üéâ Test Completed</h1>
<h2>${student}</h2>
<h2>Score: ${score}/${quiz.length}</h2>
<h2>‚≠ê XP: ${xp}</h2>
<h2>üî• Streak: ${streak}</h2>
<button onclick="window.location='leaderboard.html'">Leaderboard</button>
<canvas id="confetti"></canvas>
`;

confetti();
}

// confetti
function confetti(){
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let pieces=[];
for(let i=0;i<120;i++){
pieces.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*6+2,d:Math.random()*50,color:`hsl(${Math.random()*360},100%,50%)`});
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);
pieces.forEach(p=>{
ctx.beginPath();
ctx.fillStyle=p.color;
ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
ctx.fill();
});
update();
requestAnimationFrame(draw);
}

function update(){
pieces.forEach(p=>{
p.y+=Math.cos(p.d)+2;
p.x+=Math.sin(p.d);
if(p.y>canvas.height){p.y=0;p.x=Math.random()*canvas.width;}
});
}
draw();
}

</script>

</body>
</html>