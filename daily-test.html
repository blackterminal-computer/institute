<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Test</title>
<style>
body{
background:#020617;
font-family:Arial;
color:white;
text-align:center;
padding:20px;
padding-bottom:90px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:18px;
max-width:500px;
margin:auto;
box-shadow:0 0 30px rgba(0,0,0,0.6);
}

h1{color:#22c55e}

.option{
background:#1e293b;
padding:14px;
margin:10px 0;
border-radius:12px;
cursor:pointer;
transition:0.15s;
border:1px solid #334155;
}

/* simple click press effect */
.option.selected{
background:#334155;
transform:scale(0.96);
}

/* lock after click */
.option.lock{
pointer-events:none;
opacity:0.6;
}

button{
position:fixed;
bottom:15px;
left:50%;
transform:translateX(-50%);
width:90%;
max-width:500px;
padding:16px;
border:none;
border-radius:14px;
font-size:18px;
font-weight:bold;
background:linear-gradient(90deg,#6366f1,#06b6d4);
color:white;
z-index:999;
}

.timer{
font-size:20px;
color:#22c55e;
margin-bottom:10px;
}
</style>
</head>
<body>
<div class="card" id="quizBox">
<h1>üß† Daily Test</h1>
<div class="timer">‚è± <span id="time">20</span>s</div>
<h3 id="qtext">Loading...</h3>
<div id="options"></div>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc, getDoc, setDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let questions=[];
let index=0;
let score=0;
let selected=null;
let timer=20;
let interval;

let student=localStorage.getItem("studentName") || "Guest";

async function loadQ(){
let snap=await getDocs(collection(db,"daily_mcq"));
questions=[];
snap.forEach(d=>questions.push(d.data()));

questions=questions.slice(0,20);
showQ();
}

function showQ(){
if(index>=questions.length){ finish(); return;}

selected=null;
timer=20;
document.getElementById("time").innerText=timer;

let q=questions[index];
document.getElementById("qtext").innerText=(index+1)+". "+q.question;

let html="";
["a","b","c","d"].forEach(k=>{
html+=`<div class="option" onclick="selectOpt(this,'${k}')">${q[k]}</div>`;
});
document.getElementById("options").innerHTML=html;

clearInterval(interval);
interval=setInterval(()=>{
timer--;
document.getElementById("time").innerText=timer;
if(timer<=0) nextQ();
},1000);
}

window.selectOpt=function(el,val){
if(selected) return;

selected=val;
el.classList.add("selected");

document.querySelectorAll(".option").forEach(o=>{
o.classList.add("lock");
});
}

window.nextQ=function(){
let q=questions[index];
if(selected && selected==q.correct.toLowerCase()) score+=2;
index++;
showQ();
}

async function finish(){
clearInterval(interval);

let xpEarn=score;

let ref=doc(db,"students",student);
let snap=await getDoc(ref);

if(snap.exists()){
let old=snap.data().xp||0;
await updateDoc(ref,{xp:old+xpEarn});
}else{
await setDoc(ref,{xp:xpEarn});
}

document.body.innerHTML=`
<div class="card">
<h1>üèÅ Test Finished</h1>
<h2 style="color:#22c55e">Score: ${score}</h2>
<h3>XP Earned: ${xpEarn}</h3>
<br>
<button onclick="location.href='index.html'">üè† Home</button>
</div>`;
}

loadQ();
</script>
</body>
</html>
