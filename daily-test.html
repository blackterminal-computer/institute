<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Test</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:18px;
max-width:600px;
margin:auto;
margin-top:30px;
}

button{
padding:12px 18px;
margin:8px;
border:none;
border-radius:10px;
font-size:16px;
background:linear-gradient(90deg,#6366f1,#06b6d4);
color:white;
}

.opt{
display:block;
background:#111827;
margin:8px;
padding:12px;
border-radius:10px;
cursor:pointer;
}

.timer{
font-size:20px;
color:#22c55e;
}
</style>
</head>
<body>

<div class="card">
<h2>üß† Daily Exam</h2>
<div class="timer" id="timer">Loading...</div>
<h3 id="q">Loading question...</h3>

<div id="options"></div>

<button onclick="nextQ()">Next</button>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, getDocs }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let questions=[];
let index=0;
let score=0;
let selected="";
let time=20;

/* LOAD QUESTIONS */
async function loadQ(){

let snap=await getDocs(collection(db,"daily_mcq"));
snap.forEach(d=>{
questions.push(d.data());
});

// shuffle
questions.sort(()=>Math.random()-0.5);

// take 15 only
questions=questions.slice(0,15);

showQ();
startTimer();
}

function showQ(){

if(index>=questions.length){
finish();
return;
}

let q=questions[index];
document.getElementById("q").innerHTML=
`Q${index+1}. ${q.question}`;

document.getElementById("options").innerHTML=`
<div class="opt" onclick="select('A')">A. ${q.a}</div>
<div class="opt" onclick="select('B')">B. ${q.b}</div>
<div class="opt" onclick="select('C')">C. ${q.c}</div>
<div class="opt" onclick="select('D')">D. ${q.d}</div>
`;

selected="";
time=20;
}

window.select=function(v){
selected=v;
}

/* NEXT */
window.nextQ=function(){

let q=questions[index];

if(selected==q.correct){
score++;
}

index++;
showQ();
}

/* TIMER */
function startTimer(){
setInterval(()=>{
time--;
document.getElementById("timer").innerHTML="‚è± "+time+"s";

if(time<=0){
index++;
showQ();
time=20;
}
},1000);
}

/* FINISH */
function finish(){

let student=localStorage.getItem("studentName")||"Student";

// XP add
let xpData=JSON.parse(localStorage.getItem("xpData"))||{};
xpData[student]=(xpData[student]||0)+100;
localStorage.setItem("xpData",JSON.stringify(xpData));

alert("Test finished üéâ Score: "+score+"/15 (+100 XP)");

window.location="leaderboard.html";
}

loadQ();

</script>
</body>
</html>