<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BT Admin | Command Center</title>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { 
            --primary: #6366f1; --accent: #06b6d4; --danger: #ef4444; 
            --bg: #020617; --card: #0f172a; --success: #22c55e; --gold: #facc15;
            --glass: rgba(255, 255, 255, 0.03); --glass-border: rgba(255, 255, 255, 0.08);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--bg); color: white; background-image: radial-gradient(circle at top right, #1e1b4b, transparent); min-height: 100vh; padding: 15px; padding-bottom: 50px; }
        .container { max-width: 500px; margin: 0 auto; }

        /* HEADER */
        header { text-align: center; padding: 20px 0; }
        .logo-text { font-size: 22px; font-weight: 800; letter-spacing: -1px; }
        .logo-text span { color: var(--primary); text-shadow: 0 0 15px rgba(99, 102, 241, 0.5); }

        /* TABS */
        .tabs { display: flex; gap: 8px; margin-bottom: 25px; background: var(--glass); padding: 8px; border-radius: 20px; border: 1px solid var(--glass-border); position: sticky; top: 10px; z-index: 100; backdrop-filter: blur(10px); }
        .tab-btn { flex: 1; padding: 12px 5px; border-radius: 14px; border: none; background: transparent; color: #64748b; font-size: 11px; font-weight: 700; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.3s; }
        .tab-btn i { font-size: 18px; }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 8px 20px rgba(99, 102, 241, 0.3); }

        /* SECTIONS */
        .admin-section { background: var(--card); padding: 22px; border-radius: 28px; border: 1px solid var(--glass-border); margin-bottom: 20px; display: none; animation: slideUp 0.4s ease-out; }
        .admin-section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h3 { font-size: 18px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; color: var(--accent); }

        /* INPUTS */
        .input-group { margin-bottom: 18px; }
        label { display: block; font-size: 10px; font-weight: 800; color: #94a3b8; text-transform: uppercase; margin: 0 0 6px 6px; letter-spacing: 1px; }
        input, select, textarea { width: 100%; padding: 14px; background: rgba(0,0,0,0.3); border: 1px solid #334155; color: white; border-radius: 16px; outline: none; font-size: 14px; transition: 0.3s; }
        input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1); }

        /* SWITCH TOGGLE */
        .switch-container { display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.2); padding: 15px; border-radius: 16px; margin-bottom: 15px; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(24px); }

        .price-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
        .btn-action { width: 100%; padding: 16px; background: linear-gradient(135deg, var(--primary), #4f46e5); color: white; border: none; border-radius: 18px; font-weight: 800; font-size: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }

        /* STATS CARDS */
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .stat-box { padding: 15px; border-radius: 20px; border: 1px solid var(--glass-border); }

        /* ITEM CARDS */
        .item-card { background: var(--glass); border: 1px solid var(--glass-border); padding: 16px; border-radius: 22px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 9px; padding: 3px 8px; border-radius: 6px; font-weight: 900; text-transform: uppercase; display: inline-block; margin-bottom: 5px; }
        .b-hot { background: #ff4d4d; } .b-new { background: #06b6d4; } .b-trending { background: var(--gold); color: black; }
        .b-best { background: #a855f7; } .b-limited { background: #f97316; } .b-free { background: var(--success); }

        .delete-btn { width: 40px; height: 40px; border-radius: 12px; background: rgba(239, 68, 68, 0.1); color: var(--danger); border: none; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo-text">BT <span>COMMAND</span> CENTER</div>
    </header>

    <nav class="tabs">
        <button class="tab-btn active" onclick="switchTab('add-tab', this)"><i class="ri-add-box-line"></i>Course</button>
        <button class="tab-btn" onclick="switchTab('refer-tab', this)"><i class="ri-gift-line"></i>Refer</button>
        <button class="tab-btn" onclick="switchTab('ann-tab', this)"><i class="ri-notification-3-line"></i>Alert</button>
        <button class="tab-btn" onclick="switchTab('logs-tab', this)"><i class="ri-history-line"></i>Logs</button>
        <button class="tab-btn" onclick="switchTab('list-tab', this)"><i class="ri-broadcast-line"></i>Live</button>
    </nav>

    <div id="ann-tab" class="admin-section">
        <h3><i class="ri-megaphone-fill"></i> Global Announcement</h3>
        <div class="switch-container">
            <div>
                <b style="font-size: 14px;">Banner Status</b><br>
                <small style="font-size: 10px; color: #94a3b8;">Show/Hide banner on User App</small>
            </div>
            <label class="toggle-switch">
                <input type="checkbox" id="ann-show">
                <span class="slider"></span>
            </label>
        </div>
        <div class="input-group">
            <label>Banner Text</label>
            <input type="text" id="ann-text" placeholder="e.g. University Verified Computer Institute">
        </div>
        <button class="btn-action" style="background: var(--primary);" onclick="updateAnnouncement()">
            <i class="ri-save-line"></i> SAVE ANNOUNCEMENT
        </button>
    </div>

    <div id="add-tab" class="admin-section active">
        <h3><i class="ri-rocket-2-fill"></i> Deploy Course</h3>
        <div class="input-group"><label>Title</label><input type="text" id="c-name" placeholder="Ethical Hacking Pro"></div>
        <div class="input-group">
            <label>Badge</label>
            <select id="c-tag">
                <option value="none">No Badge</option>
                <option value="HOT">üî• HOT SELLING</option>
                <option value="NEW">‚ú® NEWLY ADDED</option>
                <option value="TRENDING">üìà TRENDING NOW</option>
                <option value="BEST">üèÜ BEST SELLER</option>
                <option value="LIMITED">‚è≥ LIMITED TIME</option>
                <option value="FREE">üéÅ FREE COURSE</option>
            </select>
        </div>
        <div class="price-row">
            <div class="input-group"><label>Old Price</label><input type="number" id="c-old" placeholder="2999"></div>
            <div class="input-group"><label>Offer Price</label><input type="number" id="c-new" placeholder="499"></div>
        </div>
        <button class="btn-action" onclick="addCourse()"><i class="ri-upload-cloud-2-line"></i> PUBLISH LIVE</button>
    </div>

    <div id="refer-tab" class="admin-section">
        <h3><i class="ri-gift-fill"></i> Reward Config</h3>
        <div class="stat-grid">
            <div class="stat-box" style="background: rgba(99, 102, 241, 0.1);">
                <label>TOTAL PAYOUT</label><h2 id="st-payout">‚Çπ0</h2>
            </div>
            <div class="stat-box" style="background: rgba(34, 197, 94, 0.1);">
                <label>TOTAL REFERS</label><h2 id="st-count">0</h2>
            </div>
        </div>
        <div class="input-group"><label>Reward Per Student (‚Çπ)</label><input type="number" id="refer-amt"></div>
        <div class="input-group"><label>Promo Description</label><textarea id="refer-desc"></textarea></div>
        <button class="btn-action" style="background: var(--accent);" onclick="updateRefer()">UPDATE SYSTEM</button>
    </div>

    <div id="logs-tab" class="admin-section">
        <h3><i class="ri-pulse-line"></i> Referral Stream</h3>
        <div id="referral-logs"></div>
    </div>

    <div id="list-tab" class="admin-section">
        <h3><i class="ri-list-check"></i> Live Courses (<span id="count">0</span>)</h3>
        <div id="live-list"></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, addDoc, onSnapshot, deleteDoc, doc, setDoc, getDoc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
        authDomain: "black-terminal-f2c91.firebaseapp.com",
        projectId: "black-terminal-f2c91",
        storageBucket: "black-terminal-f2c91.appspot.com",
        messagingSenderId: "552489994197",
        appId: "1:552489994197:web:7662331264c334ffbadf5c"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // TAB SWITCHER
    window.switchTab = (id, btn) => {
        document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        btn.classList.add('active');
    };

    // --- ANNOUNCEMENT LOGIC ---
    window.updateAnnouncement = async () => {
        const text = document.getElementById('ann-text').value;
        const show = document.getElementById('ann-show').checked;
        await setDoc(doc(db, "settings", "announcement"), {
            text: text,
            show: show
        });
        alert("Banner Updated! üì¢");
    };

    // Load Initial Announcement Data
    getDoc(doc(db, "settings", "announcement")).then(s => {
        if(s.exists()){
            document.getElementById('ann-text').value = s.data().text;
            document.getElementById('ann-show').checked = s.data().show;
        }
    });

    // ADD COURSE
    window.addCourse = async () => {
        const name = document.getElementById('c-name').value;
        const op = document.getElementById('c-old').value;
        const np = document.getElementById('c-new').value;
        if(!name || !np) return alert("Fill Name and Offer Price");
        await addDoc(collection(db, "courses"), {
            name, tag: document.getElementById('c-tag').value,
            oldPrice: op || np, newPrice: np, timestamp: serverTimestamp()
        });
        alert("Deployed! üöÄ");
    };

    // UPDATE REFERRAL
    window.updateRefer = async () => {
        await setDoc(doc(db, "settings", "referral"), {
            amount: document.getElementById('refer-amt').value,
            description: document.getElementById('refer-desc').value
        });
        alert("Settings Synced! üéÅ");
    };

    // SYNC DATA (Original logic continues...)
    onSnapshot(collection(db, "courses"), (snap) => {
        const list = document.getElementById('live-list');
        document.getElementById('count').innerText = snap.size;
        list.innerHTML = "";
        snap.forEach(d => {
            const c = d.data();
            list.innerHTML += `<div class="item-card">
                <div><span class="badge b-${c.tag?.toLowerCase()}">${c.tag}</span><br><b>${c.name}</b><br>
                <small>‚Çπ${c.newPrice} <strike style="opacity:0.5">‚Çπ${c.oldPrice}</strike></small></div>
                <button class="delete-btn" onclick="delC('${d.id}')"><i class="ri-delete-bin-line"></i></button>
            </div>`;
        });
    });

    onSnapshot(collection(db, "referrals"), (snap) => {
        const logs = document.getElementById('referral-logs');
        let total = 0;
        logs.innerHTML = "";
        snap.forEach(d => {
            const r = d.data();
            total += Number(r.amount);
            logs.innerHTML += `<div class="item-card">
                <div><b>${r.joinedUser || 'New User'}</b><br><small>Via: ${r.referrerCode}</small></div>
                <div style="color:var(--gold); font-weight:800;">+‚Çπ${r.amount}</div>
            </div>`;
        });
        document.getElementById('st-payout').innerText = "‚Çπ" + total;
        document.getElementById('st-count').innerText = snap.size;
    });

    window.delC = (id) => confirm("Delete permanently?") && deleteDoc(doc(db, "courses", id));

    // Load Initial Refer Data
    const rRef = doc(db, "settings", "referral");
    getDoc(rRef).then(s => {
        if(s.exists()){
            document.getElementById('refer-amt').value = s.data().amount;
            document.getElementById('refer-desc').value = s.data().description;
        }
    });
</script>
</body>
</html>
