<!-- ============================= -->
<!-- ADMIN PAYMENT PANEL PART 1   -->
<!-- File name: admin-payment.html -->
<!-- ============================= -->
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Payment Panel</title>
<style>
body{background:#020617;color:white;font-family:Arial;text-align:center;padding:20px}
.card{background:#0f172a;padding:25px;border-radius:16px;max-width:520px;margin:auto;margin-top:20px}
input,select{width:90%;padding:12px;margin:8px;border-radius:10px;border:none;font-size:16px}
button{padding:10px 16px;border:none;border-radius:10px;margin:6px;font-size:15px;font-weight:bold;background:linear-gradient(90deg,#6366f1,#06b6d4);color:white}
h2{color:#22c55e}
.student{background:#111827;padding:14px;margin:10px;border-radius:12px}
.overdue{color:red;font-weight:bold}
</style>
</head>
<body>
<div class="card">
<h2>ðŸ’° Add Student</h2>
<input id="name" placeholder="Student name">
<select id="duration">
<option value="3">3 Month</option>
<option value="6">6 Month</option>
<option value="12">12 Month</option>
</select>
<input type="month" id="start">
<button onclick="addStudent()">Add</button>
</div>
<div class="card">
<h2>ðŸ“Š Payment Control</h2>
<div id="list"></div>
</div>
<div class="card">
<h2>ðŸ’µ Total Collection</h2>
<h1 id="total">0</h1>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, collection, getDocs, updateDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

window.addStudent=async function(){
let name=document.getElementById("name").value;
let duration=document.getElementById("duration").value;
let start=document.getElementById("start").value;

if(!name||!start){alert("Fill all");return;}

await setDoc(doc(db,"payments",name),{
name:name,
duration:Number(duration),
monthly:500,
start:start,
paidMonths:0,
totalPaid:0
});

alert("Student added");
load();
}

async function markPaid(name){
let ref=doc(db,"payments",name);
let snap=await getDocs(collection(db,"payments"));
let s;

snap.forEach(d=>{if(d.id==name){s=d.data();}});

let paid=s.paidMonths+1;
let total=s.totalPaid+500;

await updateDoc(ref,{paidMonths:paid,totalPaid:total});
load();
}

async function fullPaid(name){
let ref=doc(db,"payments",name);
let snap=await getDocs(collection(db,"payments"));
let s;

snap.forEach(d=>{if(d.id==name){s=d.data();}});

let total=s.duration*500;

await updateDoc(ref,{
paidMonths:s.duration,
totalPaid:total
});
load();
}

async function load(){
let snap=await getDocs(collection(db,"payments"));
let html="";
let total=0;

let today=new Date();
let cm=today.getMonth()+1;
let cy=today.getFullYear();

snap.forEach(d=>{
let s=d.data();
total+=s.totalPaid;

let parts=s.start.split("-");
let sm=Number(parts[1]);
let sy=Number(parts[0]);

let passed=(cy-sy)*12+(cm-sm)+1;
let due=passed-s.paidMonths;

let overdue= due>0 ? `<span class="overdue">OVERDUE</span>`:"";

html+=`
<div class="student">
<b>${s.name}</b><br>
Paid: ${s.paidMonths}/${s.duration}<br>
Collected: â‚¹${s.totalPaid}<br>
${overdue}<br>
<button onclick="markPaid('${s.name}')">Mark Paid</button>
<button onclick="fullPaid('${s.name}')">Full Paid</button>
</div>`;
});

document.getElementById("list").innerHTML=html;
document.getElementById("total").innerHTML="â‚¹"+total;
}

load();
</script>
</body>
</html>
