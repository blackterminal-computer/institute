<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Payment System</title>

<style>
body{background:#020617;color:white;font-family:Arial;text-align:center;padding:20px}
.card{background:#0f172a;padding:25px;border-radius:16px;max-width:500px;margin:auto;margin-top:20px}
input{width:90%;padding:12px;margin:8px;border-radius:10px;border:none;font-size:16px}

button{
padding:10px 16px;
border:none;
border-radius:10px;
margin:6px;
font-size:15px;
font-weight:bold;
background:linear-gradient(90deg,#6366f1,#06b6d4);
color:white;
}

.student{background:#111827;padding:14px;margin:10px;border-radius:12px}

.overdue{color:red;font-weight:bold}
.paid{color:#22c55e;font-weight:bold}
.completed{color:#38bdf8;font-weight:bold}

.del{background:red}
.completeBtn{background:orange}

h2{color:#22c55e}
</style>
</head>
<body>

<div class="card">
<h2>âž• Add Student</h2>
<input id="name" placeholder="Student name">
<button onclick="addStudent()">Add Student</button>
</div>

<div class="card">
<h2>ðŸ“Š Active Students</h2>
<div id="list"></div>
</div>

<div class="card">
<h2>ðŸ’° Paid This Month</h2>
<h1 id="total">â‚¹0</h1>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, collection, getDocs, updateDoc, deleteDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

const monthlyFee = 500;

/* ADD STUDENT */
window.addStudent = async function(){

let name=document.getElementById("name").value.trim();
if(!name){alert("Enter name");return;}

await setDoc(doc(db,"students_pay",name),{
name:name,
lastPaidMonth:"",
lastPaidDate:"",
completed:false
});

document.getElementById("name").value="";
load();
}

/* MARK PAID */
window.markPaid = async function(name){

let today=new Date();
let m=today.getMonth()+1;
let y=today.getFullYear();
let monthKey=y+"-"+m;

await updateDoc(doc(db,"students_pay",name),{
lastPaidMonth:monthKey,
lastPaidDate:today.toLocaleDateString()
});

load();
}

/* COURSE COMPLETE */
window.completeCourse = async function(name){
if(!confirm("Mark course completed?")) return;

await updateDoc(doc(db,"students_pay",name),{
completed:true
});

load();
}

/* DELETE */
window.delStudent = async function(name){
if(!confirm("Delete student?")) return;
await deleteDoc(doc(db,"students_pay",name));
load();
}

/* LOAD */
async function load(){

let snap=await getDocs(collection(db,"students_pay"));
let html="";
let total=0;

let today=new Date();
let m=today.getMonth()+1;
let y=today.getFullYear();
let monthKey=y+"-"+m;

snap.forEach(d=>{

let s=d.data();
let status="";
let cls="";
let btn="";

if(s.completed){
status="COURSE COMPLETED";
cls="completed";
btn="";
}
else if(s.lastPaidMonth===monthKey){
status="PAID";
cls="paid";
total+=monthlyFee;
btn=`<button onclick="markPaid('${s.name}')">Mark Paid</button>`;
}
else{
status="OVERDUE";
cls="overdue";
btn=`<button onclick="markPaid('${s.name}')">Mark Paid</button>`;
}

html+=`
<div class="student">
<b>${s.name}</b><br>
Status: <span class="${cls}">${status}</span><br>
${s.lastPaidDate?`Paid Date: ${s.lastPaidDate}<br>`:""}
${btn}
<button class="completeBtn" onclick="completeCourse('${s.name}')">Course Completed</button>
<button class="del" onclick="delStudent('${s.name}')">Delete</button>
</div>
`;

});

document.getElementById("list").innerHTML=html;
document.getElementById("total").innerHTML="â‚¹"+total;
}

load();

</script>
</body>
</html>