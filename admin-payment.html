<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Payment Pro</title>
<style>
body{background:#020617;color:white;font-family:Arial;text-align:center;padding:20px}
.card{background:#0f172a;padding:25px;border-radius:16px;max-width:540px;margin:auto;margin-top:20px}
input,select{width:90%;padding:12px;margin:8px;border-radius:10px;border:none;font-size:16px}
button{padding:10px 16px;border:none;border-radius:10px;margin:6px;font-size:15px;font-weight:bold;background:linear-gradient(90deg,#6366f1,#06b6d4);color:white}
h2{color:#22c55e}
.student{background:#111827;padding:14px;margin:10px;border-radius:12px}
.overdue{color:red;font-weight:bold}
.del{background:red}
</style>
</head>
<body>
<div class="card">
<h2>âž• Add Student Payment</h2>
<input id="name" placeholder="Student name">
<select id="duration">
<option value="3">3 Month</option>
<option value="6">6 Month</option>
<option value="12">12 Month</option>
</select>
<input type="month" id="admissionMonth" placeholder="Admission Month">
<input type="number" id="admissionFee" placeholder="Admission Fee">
</div>
<div class="card">
<h2>ðŸ“Š Students Payment Control</h2>
<div id="list"></div>
</div>
<div class="card">
<h2>ðŸ’° Total Collection</h2>
<h1 id="total">0</h1>
</div>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, setDoc, collection, getDocs, updateDoc, deleteDoc }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

/* ADD STUDENT */
window.addStudent=async function(){

let name=document.getElementById("name").value;
let duration=Number(document.getElementById("duration").value);
let admissionMonth=document.getElementById("admissionMonth").value;
let admissionFee=Number(document.getElementById("admissionFee").value);

if(!name||!admissionMonth||!admissionFee){
alert("Fill all fields");return;
}

let today=new Date();
let cm=today.getMonth()+1;
let cy=today.getFullYear();

let parts=admissionMonth.split("-");
let sm=Number(parts[1]);
let sy=Number(parts[0]);

let monthsPassed=(cy-sy)*12+(cm-sm)+1;
if(monthsPassed<0) monthsPassed=0;

let totalMonthly=monthsPassed*500;
let totalPaid=admissionFee+totalMonthly;

await setDoc(doc(db,"payments",name),{
name:name,
duration:duration,
monthly:500,
admissionMonth:admissionMonth,
admissionFee:admissionFee,
paidMonths:monthsPassed,
totalPaid:totalPaid
});

alert("Student added with auto calculation");
load();
}

/* MARK MONTH PAID */
window.markPaid=async function(name){
let ref=doc(db,"payments",name);
let snap=await getDocs(collection(db,"payments"));
let s;

snap.forEach(d=>{if(d.id==name){s=d.data();}});

await updateDoc(ref,{
paidMonths:s.paidMonths+1,
totalPaid:s.totalPaid+500
});

load();
}

/* FULL PAID */
window.fullPaid=async function(name){
let ref=doc(db,"payments",name);
let snap=await getDocs(collection(db,"payments"));
let s;

snap.forEach(d=>{if(d.id==name){s=d.data();}});

let total=s.admissionFee+(s.duration*500);

await updateDoc(ref,{
paidMonths:s.duration,
totalPaid:total
});

load();
}

/* DELETE STUDENT */
window.delStudent=async function(name){
if(!confirm("Delete student?")) return;
await deleteDoc(doc(db,"payments",name));
load();
}

/* LOAD LIST */
async function load(){
let snap=await getDocs(collection(db,"payments"));
let html="";
let total=0;

let today=new Date();
let cm=today.getMonth()+1;
let cy=today.getFullYear();

snap.forEach(d=>{
let s=d.data();
total+=s.totalPaid;

let parts=s.admissionMonth.split("-");
let sm=Number(parts[1]);
let sy=Number(parts[0]);

let passed=(cy-sy)*12+(cm-sm)+1;
let due=passed-s.paidMonths;

let overdue= due>0 ? `<span class="overdue">OVERDUE</span>`:"";

html+=`
<div class="student">
<b>${s.name}</b><br>
Admission Fee: â‚¹${s.admissionFee}<br>
Paid: ${s.paidMonths}/${s.duration} months<br>
Collected: â‚¹${s.totalPaid}<br>
${overdue}<br>
<button onclick="markPaid('${s.name}')">Monthly Paid</button>
<button onclick="fullPaid('${s.name}')">Full Paid</button>
<button class="del" onclick="delStudent('${s.name}')">Delete</button>
</div>`;
});

document.getElementById("list").innerHTML=html;
document.getElementById("total").innerHTML="â‚¹"+total;
}

load();
</script>
</body>
</html>
