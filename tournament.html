<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Jackpot Tournament</title>
<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:18px;
width:92%;
max-width:420px;
margin:20px auto;
box-shadow:0 0 30px rgba(0,0,0,0.5);
}

h1{margin-top:10px}

.btn{
margin-top:20px;
padding:14px 20px;
border:none;
border-radius:12px;
background:linear-gradient(45deg,#6366f1,#06b6d4);
color:white;
font-size:16px;
width:90%;
}
input{
margin-top:15px;
padding:14px;
border-radius:12px;
border:none;
width:85%;
}
</style>
</head>
<body>
<h1>üèÜ Daily Jackpot Tournament</h1>
<h3 id="myxp">üî• Your XP: Loading...</h3>
<div class="card" id="mainCard">
<h2>üí∞ Jackpot Pool: <span id="pool">0</span> XP</h2>
<p>Entry Fee: 50 XP</p>
<p>‚è± Time: 60s</p>
<p>Score: <span id="score">0</span></p>
</div>
<div class="card">
<h2>üèÜ Live Ranking</h2>
<div id="ranking">Loading...</div>
</div>
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, getDoc, getDocs } 
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.appspot.com",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName") || "Guest";

/* USER XP */
let myxp=0;
const xpRef = doc(db,"students",student);
const snap = await getDoc(xpRef);
if(snap.exists()){
myxp=snap.data().xp || 0;
}
document.getElementById("myxp").innerText="üî• Your XP: "+myxp;

/* QUESTIONS */
const questions=[
{q:"HTML full form?",a:"hyper"},
{q:"CPU full form?",a:"central"},
{q:"RAM kya hai?",a:"memory"},
{q:"Mouse kya hai?",a:"input"},
{q:"Internet kya hai?",a:"network"},
{q:"1 byte = ?",a:"8"},
{q:"Google kya hai?",a:"search"},
{q:"Keyboard kya hai?",a:"input"},
{q:"Monitor kya hai?",a:"output"},
{q:"WWW full form?",a:"world"}
];

let qIndex=0;
let score=0;
let time=60;
let playing=false;

/* ENTER */
window.enterTournament = async function(){

if(myxp<50){
alert("‚ùå Need 50 XP");
return;
}

/* minus xp */
await updateDoc(xpRef,{xp:myxp-50});
myxp-=50;
document.getElementById("myxp").innerText="üî• Your XP: "+myxp;

alert("üî• Tournament Started");

startGame();
};

/* GAME START */
function startGame(){

playing=true;

document.getElementById("mainCard").innerHTML=`
<h2 id="timer">‚è± 60s</h2>
<h3 id="question">Loading...</h3>

<input id="ans" placeholder="Type answer">

<br>
<button class="btn" onclick="submitAns()">Submit</button>
`;

nextQ();

/* timer */
let t=setInterval(()=>{
time--;
document.getElementById("timer").innerText="‚è± "+time+"s";

if(time<=0){
clearInterval(t);
finishGame();
}
},1000);
}

/* NEXT Q */
function nextQ(){
if(qIndex>=questions.length) qIndex=0;
document.getElementById("question").innerText=questions[qIndex].q;
document.getElementById("ans").value="";
}

/* SUBMIT */
window.submitAns=function(){

let val=document.getElementById("ans").value.toLowerCase();

if(val.includes(questions[qIndex].a)){
score++;
document.getElementById("score").innerText=score;
}

qIndex++;
nextQ();
};

/* FINISH */
async function finishGame(){

document.getElementById("mainCard").innerHTML=
`<h1>üèÅ Finished</h1>
<h2>Your Score: ${score}</h2>`;

/* save score */
await addDoc(collection(db,"tournament"),{
name:student,
score:score
});

loadRanking();
}

/* RANKING */
async function loadRanking(){
let snap=await getDocs(collection(db,"tournament"));
let arr=[];
snap.forEach(d=>arr.push(d.data()));

arr.sort((a,b)=>b.score-a.score);

let html="";
arr.slice(0,10).forEach((d,i)=>{
html+=`#${i+1} ${d.name} ‚Äî ${d.score}<br>`;
});

document.getElementById("ranking").innerHTML=html;
}

loadRanking();

</script>
</body>
</html>
