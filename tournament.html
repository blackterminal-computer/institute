<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Jackpot Tournament</title>

<style>
body{background:#020617;color:white;font-family:Arial;text-align:center;padding:20px}

.card{
background:#0f172a;
padding:25px;
border-radius:18px;
width:92%;
max-width:420px;
margin:18px auto;
box-shadow:0 0 30px rgba(0,0,0,0.6);
}

.btn{
margin-top:18px;
padding:14px;
border:none;
border-radius:12px;
background:linear-gradient(45deg,#6366f1,#06b6d4);
color:white;
font-size:16px;
width:90%;
}

.opt{
display:block;
background:#111827;
padding:14px;
margin:8px;
border-radius:12px;
cursor:pointer;
}

.opt:hover{background:#1f2937}

</style>
</head>
<body>

<h1>üèÜ Daily Jackpot Tournament</h1>
<h3 id="lastWinner">Last Winner: Loading...</h3>
<h3 id="myxp">üî• Your XP: 0</h3>

<div class="card">
<h2>üí∞ Jackpot Pool: <span id="pool">0</span> XP</h2>
<h3>üë• Joined Players: <span id="players">0</span></h3>
<button class="btn" onclick="enter()">Enter Competition (50 XP)</button>
</div>

<div class="card" id="gameBox" style="display:none">
<h2 id="timer">‚è± 60</h2>
<h3 id="q">Question</h3>
<div id="options"></div>
<h3>Score: <span id="score">0</span></h3>
</div>

<div class="card">
<h2>üèÜ Live Ranking</h2>
<div id="ranking">Loading...</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, getDocs }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain:"black-terminal-f2c91.firebaseapp.com",
projectId:"black-terminal-f2c91",
storageBucket:"black-terminal-f2c91.appspot.com",
messagingSenderId:"552489994197",
appId:"1:552489994197:web:7662331264c334ffbadf5c"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

let student=localStorage.getItem("studentName")||"Guest";
let xpRef=doc(db,"students",student);
let myxp=0;
let score=0;

/* üî• USER XP */
let snap=await getDoc(xpRef);
if(snap.exists()) myxp=snap.data().xp||0;
document.getElementById("myxp").innerText="üî• Your XP: "+myxp;

/* üî• LOAD POOL */
async function loadPool(){
let snap=await getDocs(collection(db,"tournament_today"));
let total=0,count=0;
snap.forEach(d=>{
total+=d.data().entry||0;
count++;
});
document.getElementById("pool").innerText=total;
document.getElementById("players").innerText=count;
loadRanking();
}
loadPool();

/* ENTER */
window.enter=async function(){

if(myxp<50) return alert("Need 50 XP");

await updateDoc(xpRef,{xp:myxp-50});
myxp-=50;
document.getElementById("myxp").innerText="üî• Your XP: "+myxp;

await addDoc(collection(db,"tournament_today"),{
name:student,
score:0,
entry:50
});

alert("Joined Tournament üî•");
startGame();
loadPool();
}

/* üî• MCQ QUESTIONS 50 */
const questions=[
{q:"HTML full form?",a:"Hyper Text Markup Language",b:"High Text",c:"Hyper Tool",d:"Home Tool",ans:"A"},
{q:"CPU full form?",a:"Central Process Unit",b:"Central Processing Unit",c:"Computer Unit",d:"Control Unit",ans:"B"},
{q:"RAM is?",a:"Storage",b:"Memory",c:"Input",d:"Output",ans:"B"},
{q:"Mouse is?",a:"Input",b:"Output",c:"Storage",d:"CPU",ans:"A"},
{q:"Monitor is?",a:"Input",b:"Output",c:"CPU",d:"Storage",ans:"B"},
{q:"Keyboard is?",a:"Output",b:"Input",c:"CPU",d:"Memory",ans:"B"},
{q:"1 byte=?",a:"4 bit",b:"16 bit",c:"8 bit",d:"2 bit",ans:"C"},
{q:"Brain of computer?",a:"RAM",b:"CPU",c:"Mouse",d:"Monitor",ans:"B"},
{q:"WWW full form?",a:"World Wide Web",b:"World Web",c:"Web World",d:"Wide Web",ans:"A"},
{q:"Excel is?",a:"Browser",b:"Sheet software",c:"Game",d:"OS",ans:"B"}
];

/* auto repeat to make 50 */
while(questions.length<50){
questions.push(...questions);
}
questions.length=50;

let qIndex=0;
let time=60;

/* START GAME */
function startGame(){
document.getElementById("gameBox").style.display="block";
nextQ();

let t=setInterval(()=>{
time--;
document.getElementById("timer").innerText="‚è± "+time;

if(time<=0){
clearInterval(t);
finish();
}
},1000);
}

function nextQ(){
if(qIndex>=questions.length) return finish();

let q=questions[qIndex];

document.getElementById("q").innerText="Q"+(qIndex+1)+". "+q.q;

document.getElementById("options").innerHTML=`
<div class="opt" onclick="select('A')">A. ${q.a}</div>
<div class="opt" onclick="select('B')">B. ${q.b}</div>
<div class="opt" onclick="select('C')">C. ${q.c}</div>
<div class="opt" onclick="select('D')">D. ${q.d}</div>
`;
}

window.select=function(v){
let q=questions[qIndex];
if(v==q.ans){
score++;
document.getElementById("score").innerText=score;
}
qIndex++;
nextQ();
}

/* FINISH */
async function finish(){

document.getElementById("gameBox").innerHTML=
`<h2>Finished</h2><h1>Score: ${score}</h1>`;

/* update score */
let snap=await getDocs(collection(db,"tournament_today"));
snap.forEach(async(d)=>{
let data=d.data();
if(data.name==student){
await updateDoc(doc(db,"tournament_today",d.id),{score:score});
}
});

loadRanking();
}

/* RANKING */
async function loadRanking(){
let snap=await getDocs(collection(db,"tournament_today"));
let arr=[];
snap.forEach(d=>arr.push(d.data()));
arr.sort((a,b)=>b.score-a.score);

let html="";
arr.forEach((d,i)=>{
html+=`#${i+1} ${d.name} ‚Äî ${d.score}<br>`;
});
document.getElementById("ranking").innerHTML=html||"No players";
}

/* LAST WINNER */
async function loadLastWinner(){
let snap=await getDoc(doc(db,"tournament_history","last"));
if(!snap.exists()){
document.getElementById("lastWinner").innerText="No winner yet";
return;
}
let d=snap.data();
document.getElementById("lastWinner").innerText=
"üèÜ Last Winner: "+d.name+" won "+d.xp+" XP";
}
loadLastWinner();

</script>
</body>
</html>