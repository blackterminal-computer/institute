<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Tournament</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:16px;
margin:20px auto;
width:90%;
max-width:420px;
box-shadow:0 0 25px rgba(0,0,0,0.5);
}

button{
padding:15px;
margin:8px;
width:90%;
border:none;
border-radius:12px;
font-size:16px;
color:white;
background:linear-gradient(45deg,#6366f1,#06b6d4);
}

h1{margin-bottom:5px}
#xp{color:#22c55e;font-weight:bold}
</style>
</head>
<body>

<h1>üèÜ Live Tournament</h1>
<h3>Your XP: <span id="xp">0</span></h3>

<div class="card">
‚è± <span id="timer">60</span>s<br><br>
Score: <span id="score">0</span><br><br>
Entry fee: 50 XP<br><br>

<button onclick="enterTournament()">Enter Tournament</button>
</div>

<div class="card">
<div id="questionBox">Enter tournament to start</div>
</div>

<div class="card">
<h3>üèÜ Live Ranking</h3>
<div id="rank"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, collection, addDoc, getDocs, query, orderBy, limit }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.appspot.com",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName");
let xp=0;
let score=0;

const xpRef = doc(db,"students",student);

async function loadXP(){
let snap = await getDoc(xpRef);
if(snap.exists()){
xp = snap.data().xp || 0;
document.getElementById("xp").innerHTML=xp;
}
}
loadXP();

window.enterTournament = async function(){

if(xp<50){
alert("Need 50 XP to enter");
return;
}

xp -= 50;
await updateDoc(xpRef,{xp:xp});
document.getElementById("xp").innerHTML=xp;

alert("üî• Entered Tournament");
startGame();
}

let questions=[
{q:"HTML full form?",a:["Hyper Text Markup Language","Home Tool","Hyperlinks"],c:0},
{q:"CPU full form?",a:["Central Process Unit","Central Processing Unit","Computer"],c:1},
{q:"1 KB = ?",a:["1024 bytes","100 bytes","1000"],c:0},
{q:"Mouse is?",a:["Input","Output","CPU"],c:0},
{q:"WWW full form?",a:["World Wide Web","Web World","Wide"],c:0},
{q:"RAM is?",a:["Memory","Storage","Monitor"],c:0},
{q:"Excel used for?",a:["Typing","Calculation","Game"],c:1},
{q:"Keyboard?",a:["Input","Output","Printer"],c:0},
{q:"Monitor?",a:["Input","Output","CPU"],c:1},
{q:"Internet?",a:["Network","CPU","Game"],c:0}
];

let currentQ=0;

function showQuestion(){

if(currentQ>=questions.length){
finishTournament();
return;
}

let q=questions[currentQ];

document.getElementById("questionBox").innerHTML=`
<h3>${q.q}</h3>
<button onclick="ans(0)">${q.a[0]}</button>
<button onclick="ans(1)">${q.a[1]}</button>
<button onclick="ans(2)">${q.a[2]}</button>
`;
}

window.ans=function(i){

let q=questions[currentQ];

if(i==q.c){
score++;
document.getElementById("score").innerHTML=score;
}

currentQ++;
showQuestion();
}

function startGame(){

showQuestion();

let t=60;
let timer=setInterval(()=>{
t--;
document.getElementById("timer").innerHTML=t;

if(t<=0){
clearInterval(timer);
finishTournament();
}
},1000);

}

async function finishTournament(){

alert("Tournament finished. Score: "+score);

await addDoc(collection(db,"tournament_scores"),{
name:student,
score:score,
time:Date.now()
});

loadRanking();
}

async function loadRanking(){

let q = query(collection(db,"tournament_scores"),orderBy("score","desc"),limit(10));
let snap = await getDocs(q);

let html="";
let i=1;

snap.forEach(d=>{
let data=d.data();
html+=`#${i} ${data.name} ‚Äî ${data.score}<br>`;
i++;
});

document.getElementById("rank").innerHTML=html;
}

loadRanking();

</script>
</body>
</html>