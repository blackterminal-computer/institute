<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Tournament</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
padding:20px;
}

.card{
background:#0f172a;
padding:25px;
border-radius:16px;
margin:20px auto;
width:90%;
max-width:420px;
box-shadow:0 0 25px rgba(0,0,0,0.5);
}

button{
background:linear-gradient(45deg,#3b82f6,#06b6d4);
border:none;
padding:15px;
width:100%;
color:white;
font-size:18px;
border-radius:12px;
margin-top:15px;
}

.live{
color:#22c55e;
font-weight:bold;
animation:pulse 1s infinite;
}

@keyframes pulse{
0%{opacity:1}
50%{opacity:.4}
100%{opacity:1}
}

</style>
</head>
<body>

<h1>üèÜ Live Tournament</h1>

<div class="card">
<h2>‚è± <span id="timer">60</span>s</h2>
<h3>Score: <span id="score">0</span></h3>

<h3 id="myxp">üî• Your XP: loading...</h3>
<p>Entry fee: 50 XP</p>

<button onclick="enterTournament()">Enter Tournament (50 XP)</button>
</div>

<div class="card">
<h2>üèÜ Live Ranking</h2>
<div id="ranking">Loading...</div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, collection, addDoc, onSnapshot, query, orderBy, limit }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.appspot.com",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName");
if(!student){
student = prompt("Enter your name");
localStorage.setItem("studentName",student);
}

let myXP = 0;
let score = 0;

async function loadXP(){
let ref = doc(db,"students",student);
let snap = await getDoc(ref);

if(!snap.exists()){
document.getElementById("myxp").innerHTML="üî• Your XP: 0";
return;
}

myXP = snap.data().xp || 0;
document.getElementById("myxp").innerHTML="üî• Your XP: "+myXP;
}

loadXP();

window.enterTournament = async function(){

if(myXP < 50){
alert("‚ùå Need 50 XP to enter");
return;
}

let ref = doc(db,"students",student);

await updateDoc(ref,{
xp: myXP - 50
});

alert("üî• Entered Tournament");

startGame();
}

function startGame(){

let t=60;
let timer=setInterval(()=>{
t--;
document.getElementById("timer").innerHTML=t;

if(t<=0){
clearInterval(timer);
finishTournament();
}
},1000);

document.body.onclick=()=>{
score++;
document.getElementById("score").innerHTML=score;
}

}

async function finishTournament(){

await addDoc(collection(db,"tournamentScores"),{
name:student,
score:score
});

alert("Tournament finished üî• Score saved");
loadRanking();

}

function loadRanking(){

let q = query(collection(db,"tournamentScores"),orderBy("score","desc"),limit(5));

onSnapshot(q,(snap)=>{
let html="";
let i=1;

snap.forEach(d=>{
let data=d.data();
html+=`#${i} ${data.name} ‚Äî ${data.score}<br>`;
i++;
});

document.getElementById("ranking").innerHTML=html;
});

}

loadRanking();

</script>
</body>
</html>