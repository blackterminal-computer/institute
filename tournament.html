<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Tournament</title>

<style>
body{
background:#020617;
color:white;
font-family:Arial;
text-align:center;
}

.header{
font-size:26px;
padding:20px;
font-weight:bold;
}

.card{
background:#0f172a;
margin:20px;
padding:20px;
border-radius:16px;
}

.timer{
font-size:28px;
color:#22c55e;
margin:10px;
}

.q{
font-size:20px;
margin:15px;
}

.opt{
background:#1e293b;
margin:8px;
padding:14px;
border-radius:10px;
}

.btn{
background:#2563eb;
padding:14px;
border:none;
border-radius:12px;
color:white;
font-size:16px;
margin-top:10px;
}

.rank{
background:#111827;
padding:12px;
margin:6px;
border-radius:8px;
}
</style>
</head>
<body>

<div class="header">üèÜ Live Tournament</div>

<div class="card">
<div class="timer">‚è± <span id="time">60</span>s</div>
<div id="score">Score: 0</div>
<div class="q" id="q">Click Start</div>
<div id="opts"></div>
<button class="btn" onclick="start()">Start Tournament</button>
</div>

<div class="card">
<h3>üèÜ Live Ranking</h3>
<div id="board"></div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, onSnapshot, getDoc }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
apiKey: "AIzaSyCEYfwfZv2Ckpg-uFLRvJkMBRlXA2w_WpI",
authDomain: "black-terminal-f2c91.firebaseapp.com",
projectId: "black-terminal-f2c91",
storageBucket: "black-terminal-f2c91.appspot.com",
messagingSenderId: "552489994197",
appId: "1:552489994197:web:7662331264c334ffbadf5c"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let student = localStorage.getItem("studentName");
let score=0;
let t=60;
let timer;
let docId="";

const questions=[
{q:"Brain of computer?",o:["CPU","RAM","Mouse","Keyboard"],a:"CPU"},
{q:"WWW stands for?",o:["World Wide Web","Web World","Wide","None"],a:"World Wide Web"},
{q:"Excel is?",o:["Spreadsheet","Game","OS","Browser"],a:"Spreadsheet"},
{q:"Keyboard is?",o:["Input","Output","CPU","None"],a:"Input"},
{q:"1 byte=?",o:["8 bit","4 bit","2 bit","16 bit"],a:"8 bit"},
{q:"Monitor is?",o:["Output","Input","CPU","None"],a:"Output"},
{q:"Full form RAM?",o:["Random Access Memory","Run Memory","Read","None"],a:"Random Access Memory"}
];

let qi=0;

// ranking live
onSnapshot(collection(db,"tournament"), async(snap)=>{
let arr=[];
snap.forEach(d=> arr.push(d.data()));
arr.sort((a,b)=>b.score-a.score);

let html="";
arr.forEach((p,i)=>{
html+=`<div class="rank">#${i+1} ${p.name} ‚Äî ${p.score}</div>`;
});
document.getElementById("board").innerHTML=html;
});

window.start = async function(){

score=0;
qi=0;
t=60;

let ref=await addDoc(collection(db,"tournament"),{
name:student,
score:0
});
docId=ref.id;

timer=setInterval(()=>{
t--;
document.getElementById("time").innerText=t;
if(t<=0) finish();
},1000);

showQ();
}

function showQ(){
if(qi>=questions.length){ finish(); return; }

let q=questions[qi];
document.getElementById("q").innerText=q.q;

let html="";
q.o.forEach(o=>{
html+=`<div class="opt" onclick="ans('${o}')">${o}</div>`;
});
document.getElementById("opts").innerHTML=html;
}

window.ans = async function(a){

let correct=questions[qi].a;
if(a==correct){
score++;
document.getElementById("score").innerText="Score: "+score;
await updateDoc(doc(db,"tournament",docId),{score:score});
}
qi++;
showQ();
}

async function finish(){
clearInterval(timer);

let xpRef = doc(db,"students",student);
let snap = await getDoc(xpRef);
let xp=snap.data().xp||0;
xp+=score*2;
await updateDoc(xpRef,{xp:xp});

alert("Tournament finished! XP added");
}

</script>
</body>
</html>